jQuery(function($){JBZoo.widget('HyperPC.SiteCompareButtons',{'compareUrl':'/index.php?option=com_hyperpc&view=compare','inCompareClass':'inCompare','compareBtn':'','addToCompareTitle':'','removeFromCompareTitle':'','addToCompareText':'','removeFromCompareText':''},{init:function($this){$(window).on('storage',function(e){switch(e.key){case'hp_compared_items':$this._updateCompareButtons($this);break;}});},_updateCompareButtons:function($this){comparedItems=JSON.parse(localStorage.getItem('hp_compared_items'))||{};$buttons=$this.$('.jsCompareAdd');$buttons.removeClass($this.getOption('inCompareClass')).attr('title',$this.getOption('addToCompareTitle')).find('.hp-compare-btn-text').text($this.getOption('addToCompareText'));$buttons.filter('.uk-disabled').each(function(){$this._unlockButton($(this));});for(var type in comparedItems){if(comparedItems.hasOwnProperty(type)){var items=comparedItems[type];for(var key in items){if(items.hasOwnProperty(key)){var itemKey=items[key].type+'-'+key;$buttons.filter('[data-itemkey="'+itemKey+'"]').addClass($this.getOption('inCompareClass')).attr('title',$this.getOption('removeFromCompareTitle')).find('.hp-compare-btn-text').text($this.getOption('removeFromCompareText'));}}}}},_lockButton:function(button){button.addClass('uk-disabled').css('opacity',1).find('.uk-icon').removeAttr('uk-icon').attr('uk-spinner','ratio: 0.667');},_unlockButton:function(button){button.removeClass('uk-disabled').css('opacity','').find('.uk-icon').removeClass('uk-spinner').removeAttr('uk-spinner').attr('uk-icon','list');},'click .jsCompareAdd':function(e,$this){var el=$(this),id=el.data('id'),type=el.data('type'),args={'optionId':null,'type':type,'itemId':id};$this._lockButton(el);if(el.data('option-id')){args.optionId=el.data('option-id');}if(el.data('stock-id')){args.stockId=el.data('stock-id');args.itemId=id+'-in-stock-'+el.data('stock-id');}if(!el.hasClass($this.getOption('inCompareClass'))){var compareUrl=$this.getOption('compareUrl');compareUrl+=compareUrl.indexOf('?')>0?'&':'?';compareUrl+='group='+$(this).closest('[data-group]').data('group')+'&type='+type;$this.ajax({'url':'/index.php','dataType':'json','data':{'format':'raw','tmpl':'component','task':'compare.add','args':args},'success':function(data){$this._unlockButton(el);if(data.result===true){el.addClass($this.getOption('inCompareClass')).attr('title',$this.getOption('removeFromCompareTitle')).find('.hp-compare-btn-text').text($this.getOption('removeFromCompareText'));var modalHtml='<div>'+'<div class="uk-grid-small uk-flex-middle" uk-grid>'+'<div class="uk-visible@s uk-flex-last@s uk-text-right">'+'<a class="uk-modal-close uk-link-muted" uk-icon="icon: close; ratio: 1.5"></a>'+'</div>'+'<span class="uk-text-success uk-visible@s" uk-icon="icon: check; ratio: 1.5"></span>'+'<div class="uk-width-1-1 uk-width-expand@s">'+data.msg+'</div>'+'<div class="uk-width-1-1 uk-width-auto@s uk-text-center">'+'<a href="'+compareUrl+'"class="jsLoadIframe uk-button uk-button-default uk-button-small uk-modal-close">'+$this.getOption('compareBtn')+'</a>'+'</div>'+'</div>'+'</div>';UIkit.notification.closeAll();UIkit.notification(modalHtml,{pos:'compare',timeout:3000});$(document).trigger('hpcompareupdated',{totalCount:data.total});localStorage.setItem('hp_compared_items',JSON.stringify(data.items));if(window.location!==window.parent.location){localStorage.setItem('hp_compared_items_count',data.count);}}},'error':function(data){$this._unlockButton(el);var modalHtml='<div>'+'<div class="uk-grid-small uk-flex-middle" uk-grid>'+'<div class="uk-visible@s uk-flex-last@s uk-text-right">'+'<a class="uk-modal-close uk-link-muted" uk-icon="icon: close; ratio: 1.5"></a>'+'</div>'+'<span class="uk-text-danger uk-visible@s" uk-icon="icon: warning; ratio: 1.5"></span>'+'<div class="uk-width-1-1 uk-width-expand@s">'+data.msg+'</div>'+'<div class="uk-width-1-1 uk-width-auto@s uk-text-center">'+'<a href="'+compareUrl+'" class="jsLoadIframe uk-button uk-button-default uk-button-small uk-modal-close">'+$this.getOption('compareBtn')+'</a>'+'</div>'+'</div>'+'</div>';UIkit.notification.closeAll();UIkit.notification(modalHtml,{pos:'compare',timeout:3000});}});}else{UIkit.notification.closeAll();$this.ajax({'data':{'format':'raw','tmpl':'component','task':'compare.remove','args':args},'dataType':'json','url':'/index.php','success':function(data){$this._unlockButton(el);if(data.result===true){el.removeClass($this.getOption('inCompareClass')).attr('title',$this.getOption('addToCompareTitle')).find('.hp-compare-btn-text').text($this.getOption('addToCompareText'));$(document).trigger('hpcompareupdated',{totalCount:data.count});localStorage.setItem('hp_compared_items',JSON.stringify(data.items));if(window.location!==window.parent.location){localStorage.setItem('hp_compared_items_count',data.count);}}},'error':function(){$this._unlockButton(el);}});}e.preventDefault();},});});